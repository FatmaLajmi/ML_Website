{% extends 'base.html' %}
{% load static %}

{% block title %}ML Predictions - Job Seekers - JobML Platform{% endblock %}

{% block content %}
<!-- Page Header Start -->
<div class="page-header">
  <div class="container">
    <div class="row">         
      <div class="col-lg-12">
        <div class="inner-header">
          <h3>ML Predictions for Job Seekers</h3>
          <p>Get AI-powered insights to enhance your job search</p>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Page Header End --> 

<!-- Content section Start --> 
<section id="content" class="section-padding">
  <div class="container">
    <!-- Display Django messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}
    
    <div class="row">
      <!-- Salary Prediction -->
      <div class="col-lg-6 col-md-6 col-xs-12 mb-4">
        <div class="box h-100">
          <div class="icon">
            <i class="lni-dollar"></i>
          </div>
          <h4>Salary Prediction</h4>
          <p>Estimate your expected salary based on your skills, experience, and job title.</p>
          <button class="btn btn-common" data-toggle="modal" data-target="#salaryModal">Predict Salary</button>
        </div>
      </div>
      
      <!-- Job Title Prediction -->
      <div class="col-lg-6 col-md-6 col-xs-12 mb-4">
        <div class="box h-100">
          <div class="icon">
            <i class="lni-briefcase"></i>
          </div>
          <h4>Job Title Recommendation</h4>
          <p>Find the best job titles that match your skills and career aspirations.</p>
          <button class="btn btn-common" data-toggle="modal" data-target="#jobTitleModal">Recommend Title</button>
        </div>
      </div>
      
      <!-- Remote Work Prediction -->
      <div class="col-lg-6 col-md-6 col-xs-12 mb-4">
        <div class="box h-100">
          <div class="icon">
            <i class="lni-home"></i>
          </div>
          <h4>Remote Work Eligibility</h4>
          <p>Check if your profile is suitable for remote work opportunities.</p>
          <button class="btn btn-common" data-toggle="modal" data-target="#remoteWorkModal">Check Eligibility</button>
        </div>
      </div>
      
      <!-- Degree Recommendation -->
      <div class="col-lg-6 col-md-6 col-xs-12 mb-4">
        <div class="box h-100">
          <div class="icon">
            <i class="lni-graduation"></i>
          </div>
          <h4>Degree Recommendation</h4>
          <p>Get recommendations on which degree or certification would benefit your career.</p>
          <button class="btn btn-common" data-toggle="modal" data-target="#degreeModal" onclick="console.log('Button clicked!')">Recommend Degree</button>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Content section End -->

<!-- Modals for Each Prediction -->
<!-- Salary Prediction Modal -->
<div class="modal fade" id="salaryModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Salary Prediction</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'predictions:job_seeker_predictions' %}">
          {% csrf_token %}
          <input type="hidden" name="prediction_type" value="salary">
          {{ salary_form.as_p }}
          <button type="submit" class="btn btn-common">Predict</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Add similar modals for other prediction types -->

<!-- Degree Prediction Modal -->
<div class="modal fade" id="degreeModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Degree Requirement Prediction</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Show prediction result if available -->
        {% if degree_result %}
        <div class="alert alert-{{ degree_result.success|yesno:'success,danger' }}" role="alert">
          <h5 class="alert-heading">
            <i class="lni-{{ degree_result.degree_mentioned|yesno:'graduation,thumbs-up' }}"></i>
            Prediction Result
          </h5>
          <hr>
          {% if degree_result.success %}
            <p class="mb-1"><strong>Prediction:</strong> {{ degree_result.prediction }}</p>
            <p class="mb-1"><strong>Confidence:</strong> {{ degree_result.confidence }}</p>
            <p class="mb-0">
              {% if degree_result.degree_mentioned %}
                This job posting likely mentions degree or educational requirements.
              {% else %}
                This job posting likely does not mention specific degree requirements.
              {% endif %}
            </p>
          {% else %}
            <p class="mb-0">{{ degree_result.error }}</p>
          {% endif %}
        </div>
        {% endif %}
        
        <!-- Degree Prediction Form -->
        <form method="post" action="{% url 'predictions:job_seeker_predictions' %}" id="degreePredictionForm">
          {% csrf_token %}
          <input type="hidden" name="prediction_type" value="degree">
          
          <div class="form-group">
            <label for="{{ degree_form.skill_count.id_for_label }}">
              {{ degree_form.skill_count.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.skill_count }}
            {% if degree_form.skill_count.help_text %}
              <small class="form-text text-muted">{{ degree_form.skill_count.help_text }}</small>
            {% endif %}
            {% if degree_form.skill_count.errors %}
              <div class="text-danger">{{ degree_form.skill_count.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ degree_form.job_title_short.id_for_label }}">
              {{ degree_form.job_title_short.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.job_title_short }}
            {% if degree_form.job_title_short.help_text %}
              <small class="form-text text-muted">{{ degree_form.job_title_short.help_text }}</small>
            {% endif %}
            {% if degree_form.job_title_short.errors %}
              <div class="text-danger">{{ degree_form.job_title_short.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ degree_form.job_via.id_for_label }}">
              {{ degree_form.job_via.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.job_via }}
            {% if degree_form.job_via.help_text %}
              <small class="form-text text-muted">{{ degree_form.job_via.help_text }}</small>
            {% endif %}
            {% if degree_form.job_via.errors %}
              <div class="text-danger">{{ degree_form.job_via.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ degree_form.company_name.id_for_label }}">
              {{ degree_form.company_name.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.company_name }}
            {% if degree_form.company_name.help_text %}
              <small class="form-text text-muted">{{ degree_form.company_name.help_text }}</small>
            {% endif %}
            {% if degree_form.company_name.errors %}
              <div class="text-danger">{{ degree_form.company_name.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ degree_form.job_country.id_for_label }}">
              {{ degree_form.job_country.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.job_country }}
            {% if degree_form.job_country.help_text %}
              <small class="form-text text-muted">{{ degree_form.job_country.help_text }}</small>
            {% endif %}
            {% if degree_form.job_country.errors %}
              <div class="text-danger">{{ degree_form.job_country.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ degree_form.search_location.id_for_label }}">
              {{ degree_form.search_location.label }}
              <span class="text-danger">*</span>
            </label>
            {{ degree_form.search_location }}
            {% if degree_form.search_location.help_text %}
              <small class="form-text text-muted">{{ degree_form.search_location.help_text }}</small>
            {% endif %}
            {% if degree_form.search_location.errors %}
              <div class="text-danger">{{ degree_form.search_location.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group text-center">
            <button type="submit" class="btn btn-common">
              <i class="lni-rocket"></i> Predict Degree Requirement
            </button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
  .box {
    padding: 30px;
    text-align: center;
    border: 1px solid #e8ecf1;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .box:hover {
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    transform: translateY(-5px);
  }
  
  .box .icon {
    font-size: 48px;
    color: #4c40ed;
    margin-bottom: 20px;
  }
  
  .box h4 {
    margin-bottom: 15px;
  }
  
  .modal-body .alert {
    margin-bottom: 20px;
  }
  
  .form-group label {
    font-weight: 600;
    color: #333;
  }
  
  .text-danger {
    color: #dc3545;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  // Auto-open degree modal if there's a prediction result
  {% if degree_result %}
  $(document).ready(function() {
    $('#degreeModal').modal('show');
  });
  {% endif %}
</script>
{% endblock %}
