{% extends 'base.html' %}
{% load static %}

{% block title %}Sign Up - JobML Platform{% endblock %}

{% block extra_css %}
<style>
  /* Role selection boxes */
  .role-selection {
    display: flex;
    gap: 20px;
    margin: 20px 0;
  }
  .role-option {
    flex: 1;
    border: 3px solid #ddd;
    border-radius: 10px;
    padding: 30px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }
  .role-option:hover {
    border-color: #ff6b6b;
    background-color: #fff5f5;
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  .role-option.selected {
    border-color: #ff6b6b;
    background-color: #ff6b6b;
    color: white;
  }
  .role-option input[type="radio"] {
    display: none;
  }
  .role-option i {
    font-size: 48px;
    margin-bottom: 15px;
    display: block;
  }
  .role-option h4 {
    margin: 10px 0 5px 0;
    font-size: 20px;
  }
  .role-option p {
    margin: 0;
    font-size: 14px;
    opacity: 0.8;
  }
  .role-option.selected p {
    opacity: 1;
  }
  
  /* Skill cards */
  .skill-card {
    display: inline-block;
    padding: 10px 18px;
    margin: 5px;
    border: 2px solid #ddd;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    background-color: white;
  }
  .skill-card:hover {
    border-color: #ff6b6b;
    background-color: #fff5f5;
    transform: scale(1.05);
  }
  .skill-card.selected {
    background-color: #ff6b6b;
    color: white;
    border-color: #ff6b6b;
  }
  .skill-card input[type="checkbox"] {
    display: none;
  }
  .skill-checkbox-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 5px;
  }
  .conditional-field {
    display: none;
    animation: fadeIn 0.5s;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .section-divider {
    margin: 30px 0;
    border-top: 2px solid #eee;
    position: relative;
  }
  .section-divider::after {
    content: 'ADDITIONAL INFORMATION';
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 0 15px;
    color: #999;
    font-size: 12px;
    font-weight: bold;
  }
</style>
{% endblock %}

{% block content %}
<!-- Page Header Start -->
<div class="page-header">
  <div class="container">
    <div class="row">         
      <div class="col-lg-12">
        <div class="inner-header">
          <h3>Sign Up</h3>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Page Header End --> 

<!-- Content section Start --> 
<section id="content" class="section-padding">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-xs-12">
        <div class="page-login-form box">
          <h3>Create Your Account</h3>
          
          {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              {{ message }}
            </div>
            {% endfor %}
          {% endif %}
          
          <form method="post" action="{% url 'accounts:signup' %}" class="login-form">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
            {% endif %}
            
            <!-- Role Selection -->
            <div class="form-group">
              <label style="display: block; text-align: center; font-size: 18px; margin-bottom: 10px;">I am a *</label>
              <div class="role-selection">
                <div class="role-option" data-role="employer">
                  <input type="radio" name="role_select" value="employer" id="role-employer">
                  <i class="lni-briefcase"></i>
                  <h4>Employer</h4>
                  <p>I want to post jobs and hire talent</p>
                </div>
                <div class="role-option" data-role="job_seeker">
                  <input type="radio" name="role_select" value="job_seeker" id="role-jobseeker">
                  <i class="lni-user"></i>
                  <h4>Job Seeker</h4>
                  <p>I'm looking for job opportunities</p>
                </div>
              </div>
              {{ form.role.as_hidden }}
              {% if form.role.errors %}
              <div class="invalid-feedback d-block">{{ form.role.errors }}</div>
              {% endif %}
            </div>
            
            <!-- Basic Information -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="{{ form.first_name.id_for_label }}">First Name *</label>
                  {{ form.first_name }}
                  {% if form.first_name.errors %}
                  <div class="invalid-feedback d-block">{{ form.first_name.errors }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="{{ form.last_name.id_for_label }}">Last Name *</label>
                  {{ form.last_name }}
                  {% if form.last_name.errors %}
                  <div class="invalid-feedback d-block">{{ form.last_name.errors }}</div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="{{ form.email.id_for_label }}">Email *</label>
              <div class="input-icon">
                <i class="lni-envelope"></i>
                {{ form.email }}
                {% if form.email.errors %}
                <div class="invalid-feedback d-block">{{ form.email.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <div class="form-group">
              <label for="{{ form.username.id_for_label }}">Username *</label>
              <div class="input-icon">
                <i class="lni-user"></i>
                {{ form.username }}
                {% if form.username.errors %}
                <div class="invalid-feedback d-block">{{ form.username.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="{{ form.password1.id_for_label }}">Password *</label>
                  <div class="input-icon">
                    <i class="lni-lock"></i>
                    {{ form.password1 }}
                    {% if form.password1.errors %}
                    <div class="invalid-feedback d-block">{{ form.password1.errors }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="{{ form.password2.id_for_label }}">Confirm Password *</label>
                  <div class="input-icon">
                    <i class="lni-lock"></i>
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                    <div class="invalid-feedback d-block">{{ form.password2.errors }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Employer-specific fields -->
            <div id="employer-fields" class="conditional-field">
              <div class="section-divider"></div>
              <h4 style="text-align: center; color: #333; margin-bottom: 20px;">
                <i class="lni-briefcase"></i> Company Information
              </h4>
              
              <div class="form-group">
                <label for="{{ form.company_name.id_for_label }}">Company Name *</label>
                {{ form.company_name }}
                {% if form.company_name.errors %}
                <div class="invalid-feedback d-block">{{ form.company_name.errors }}</div>
                {% endif %}
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.industry.id_for_label }}">Industry *</label>
                    {{ form.industry }}
                    {% if form.industry.errors %}
                    <div class="invalid-feedback d-block">{{ form.industry.errors }}</div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.company_size.id_for_label }}">Company Size *</label>
                    {{ form.company_size }}
                    {% if form.company_size.errors %}
                    <div class="invalid-feedback d-block">{{ form.company_size.errors }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="{{ form.website.id_for_label }}">Company Website</label>
                {{ form.website }}
                {% if form.website.errors %}
                <div class="invalid-feedback d-block">{{ form.website.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <!-- Job Seeker-specific fields -->
            <div id="jobseeker-fields" class="conditional-field">
              <div class="section-divider"></div>
              <h4 style="text-align: center; color: #333; margin-bottom: 20px;">
                <i class="lni-graduation"></i> Professional Information
              </h4>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.education_level.id_for_label }}">Education Level *</label>
                    {{ form.education_level }}
                    {% if form.education_level.errors %}
                    <div class="invalid-feedback d-block">{{ form.education_level.errors }}</div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="{{ form.years_experience.id_for_label }}">Years of Experience *</label>
                    {{ form.years_experience }}
                    {% if form.years_experience.errors %}
                    <div class="invalid-feedback d-block">{{ form.years_experience.errors }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label><i class="lni-tag"></i> Select Your Skills (click to select/unselect)</label>
                <div class="skill-checkbox-wrapper">
                  {% for skill in form.skills %}
                    <div class="skill-card" data-skill-id="{{ skill.id_for_label }}">
                      {{ skill.tag }}
                      <label for="{{ skill.id_for_label }}" style="margin: 0; cursor: pointer; padding: 0; user-select: none;">
                        {{ skill.choice_label }}
                      </label>
                    </div>
                  {% endfor %}
                </div>
                {% if form.skills.errors %}
                <div class="invalid-feedback d-block">{{ form.skills.errors }}</div>
                {% endif %}
                <small class="form-text text-muted mt-2">
                  <i class="lni-information"></i> Select all skills that apply to you
                </small>
              </div>
            </div>
            
            <button type="submit" class="btn btn-common log-btn mt-3">Create Account</button>
          </form>
          
          <ul class="form-links">
            <li class="text-center"><a href="{% url 'accounts:login' %}">Already have an account? Login here</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Content section End -->
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const employerFields = document.getElementById('employer-fields');
    const jobseekerFields = document.getElementById('jobseeker-fields');
    const roleOptions = document.querySelectorAll('.role-option');
    const hiddenRoleInput = document.querySelector('input[name="role"]');
    
    // Handle role selection with visual feedback
    roleOptions.forEach(option => {
      option.addEventListener('click', function() {
        const role = this.getAttribute('data-role');
        const radioInput = this.querySelector('input[type="radio"]');
        
        // Update visual selection
        roleOptions.forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        
        // Check the radio button
        radioInput.checked = true;
        
        // Update hidden field for Django form
        if (hiddenRoleInput) {
          hiddenRoleInput.value = role;
        }
        
        // Toggle conditional fields with animation
        if (role === 'employer') {
          employerFields.style.display = 'block';
          jobseekerFields.style.display = 'none';
          // Smooth scroll to the employer fields
          setTimeout(() => {
            employerFields.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        } else if (role === 'job_seeker') {
          employerFields.style.display = 'none';
          jobseekerFields.style.display = 'block';
          // Smooth scroll to the job seeker fields
          setTimeout(() => {
            jobseekerFields.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      });
    });
    
    // Initialize role selection if one is already selected
    const checkedRadio = document.querySelector('.role-option input[type="radio"]:checked');
    if (checkedRadio) {
      checkedRadio.closest('.role-option').classList.add('selected');
      const role = checkedRadio.value;
      if (role === 'employer') {
        employerFields.style.display = 'block';
      } else if (role === 'job_seeker') {
        jobseekerFields.style.display = 'block';
      }
    }
    
    // Enhanced skill card interaction
    document.querySelectorAll('.skill-card').forEach(card => {
      const checkbox = card.querySelector('input[type="checkbox"]');
      
      // Make the entire card clickable
      card.addEventListener('click', function(e) {
        // Don't interfere with the checkbox itself
        if (e.target === checkbox) {
          return;
        }
        
        // Toggle the checkbox
        checkbox.checked = !checkbox.checked;
        
        // Toggle selected class with visual feedback
        if (checkbox.checked) {
          card.classList.add('selected');
        } else {
          card.classList.remove('selected');
        }
      });
      
      // Listen to checkbox change event for proper form handling
      if (checkbox) {
        checkbox.addEventListener('change', function() {
          if (checkbox.checked) {
            card.classList.add('selected');
          } else {
            card.classList.remove('selected');
          }
        });
      }
      
      // Initialize state based on checkbox
      if (checkbox.checked) {
        card.classList.add('selected');
      }
    });
    
    // Form validation before submission
    const form = document.querySelector('.login-form');
    if (form) {
      form.addEventListener('submit', function(e) {
        const roleValue = hiddenRoleInput ? hiddenRoleInput.value : '';
        
        // Check if role is selected
        if (!roleValue) {
          e.preventDefault();
          alert('Please select whether you are an Employer or Job Seeker');
          return false;
        }
        
        // Validate employer fields
        if (roleValue === 'employer') {
          const companyName = document.querySelector('input[name="company_name"]');
          if (companyName && !companyName.value.trim()) {
            e.preventDefault();
            alert('Please fill in all required employer fields');
            employerFields.scrollIntoView({ behavior: 'smooth', block: 'start' });
            return false;
          }
        }
        
        // Validate job seeker fields
        if (roleValue === 'job_seeker') {
          const educationLevel = document.querySelector('select[name="education_level"]');
          if (educationLevel && !educationLevel.value) {
            e.preventDefault();
            alert('Please fill in all required job seeker fields');
            jobseekerFields.scrollIntoView({ behavior: 'smooth', block: 'start' });
            return false;
          }
        }
        
        // Form is valid, allow submission
        return true;
      });
    }
  });
</script>
{% endblock %}
